
# Q2

```postgresql

GroupAggregate  (cost=48711441.74..9565567380.87 rows=20000 width=44) (actual time=13234.861..14984.662 rows=1799 loops=1)
"  Group Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (SubPlan 1), 5000))"
  ->  Merge Left Join  (cost=48711441.74..9565563694.24 rows=464885 width=40) (actual time=13234.495..14975.228 rows=87363 loops=1)
"        Merge Cond: ((generate_series('2008'::numeric, EXTRACT(year FROM now()))) = (EXTRACT(year FROM users.creationdate)))"
"        Join Filter: ((floor(((users.reputation / 5000))::double precision) * '5000'::double precision) = ((generate_series(0, (SubPlan 1), 5000)))::double precision)"
        Rows Removed by Join Filter: 8895106
        ->  Group  (cost=47728468.87..9561557968.87 rows=200000 width=36) (actual time=5770.841..5771.427 rows=1799 loops=1)
"              Group Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (SubPlan 1), 5000))"
              ->  Sort  (cost=47728468.87..47730968.87 rows=1000000 width=36) (actual time=5770.840..5770.996 rows=1799 loops=1)
"                    Sort Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (SubPlan 1), 5000))"
                    Sort Method: quicksort  Memory: 119kB
                    ->  ProjectSet  (cost=0.00..47574120.02 rows=1000000 width=36) (actual time=328.201..5770.494 rows=1799 loops=1)
                          ->  ProjectSet  (cost=0.00..5.02 rows=1000 width=32) (actual time=0.007..0.030 rows=17 loops=1)
                                ->  Result  (cost=0.00..0.01 rows=1 width=0) (actual time=0.001..0.001 rows=1 loops=1)
                          SubPlan 1
                            ->  Aggregate  (cost=47569.10..47569.11 rows=1 width=4) (actual time=339.426..339.426 rows=1 loops=17)
                                  ->  Seq Scan on users users_1  (cost=0.00..47550.44 rows=7463 width=4) (actual time=39.662..334.450 rows=87806 loops=17)
"                                        Filter: (EXTRACT(year FROM creationdate) = (generate_series('2008'::numeric, EXTRACT(year FROM now()))))"
                                        Rows Removed by Filter: 1404890
        ->  Sort  (cost=982972.87..983205.31 rows=92977 width=16) (actual time=7463.306..8045.447 rows=8981302 loops=1)
              Sort Key: (EXTRACT(year FROM users.creationdate))
              Sort Method: external sort  Disk: 3288kB
              ->  Gather  (cost=925973.45..975300.14 rows=92977 width=16) (actual time=6955.547..7451.523 rows=86197 loops=1)
                    Workers Planned: 2
                    Workers Launched: 2
                    ->  Parallel Hash Semi Join  (cost=924973.45..965002.44 rows=38740 width=16) (actual time=6935.744..7407.431 rows=28732 loops=3)
                          Hash Cond: (users.id = a.owneruserid)
                          ->  Parallel Seq Scan on users  (cost=0.00..31379.57 rows=621957 width=16) (actual time=0.464..343.182 rows=497565 loops=3)
                          ->  Parallel Hash  (cost=923828.34..923828.34 rows=91609 width=8) (actual time=6934.928..6934.932 rows=124369 loops=3)
                                Buckets: 524288 (originally 262144)  Batches: 1 (originally 1)  Memory Usage: 20672kB
                                ->  Parallel Hash Semi Join  (cost=390413.00..923828.34 rows=91609 width=8) (actual time=6636.478..6900.407 rows=124369 loops=3)
                                      Hash Cond: (a.id = v.postid)
                                      ->  Parallel Seq Scan on answers a  (cost=0.00..460464.10 rows=1844710 width=12) (actual time=0.508..4005.815 rows=1475768 loops=3)
                                      ->  Parallel Hash  (cost=386302.46..386302.46 rows=250523 width=8) (actual time=2396.108..2396.111 rows=124369 loops=3)
                                            Buckets: 262144  Batches: 4  Memory Usage: 5760kB
                                            ->  Hash Join  (cost=1.19..386302.46 rows=250523 width=8) (actual time=1476.967..2373.463 rows=124369 loops=3)
                                                  Hash Cond: (v.votetypeid = vt.id)
                                                  ->  Parallel Seq Scan on votes v  (cost=0.00..374307.48 rows=3507327 width=10) (actual time=1476.454..2242.679 rows=2812351 loops=3)
                                                        Filter: (creationdate >= (now() - '5 years'::interval))
                                                        Rows Removed by Filter: 5706453
                                                  ->  Hash  (cost=1.18..1.18 rows=1 width=2) (actual time=0.450..0.451 rows=1 loops=3)
                                                        Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                                        ->  Seq Scan on votestypes vt  (cost=0.00..1.18 rows=1 width=2) (actual time=0.438..0.440 rows=1 loops=3)
                                                              Filter: ((name)::text = 'AcceptedByOriginator'::text)
                                                              Rows Removed by Filter: 13
Planning Time: 21.086 ms
Execution Time: 14986.249 ms

```

### Com 
```
max_worker_processes = 16		# (change requires restart)
max_parallel_workers_per_gather = 4	# taken from max_parallel_workers
max_parallel_maintenance_workers = 4	# taken from max_parallel_workers
max_parallel_workers = 16		# maximum number of max_worker_processes that
```
SÃ³ utilizou 3 workers 

```postgresql
GroupAggregate  (cost=48439667.69..9565295606.82 rows=20000 width=44) (actual time=7688.386..9450.427 rows=1799 loops=1)
"  Group Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (SubPlan 1), 5000))"
  ->  Merge Left Join  (cost=48439667.69..9565291920.19 rows=464885 width=40) (actual time=7688.161..9440.539 rows=87363 loops=1)
"        Merge Cond: ((generate_series('2008'::numeric, EXTRACT(year FROM now()))) = (EXTRACT(year FROM users.creationdate)))"
"        Join Filter: ((floor(((users.reputation / 5000))::double precision) * '5000'::double precision) = ((generate_series(0, (SubPlan 1), 5000)))::double precision)"
        Rows Removed by Join Filter: 8895106
        ->  Group  (cost=47728468.87..9561557968.87 rows=200000 width=36) (actual time=5793.198..5794.010 rows=1799 loops=1)
"              Group Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (SubPlan 1), 5000))"
              ->  Sort  (cost=47728468.87..47730968.87 rows=1000000 width=36) (actual time=5793.196..5793.399 rows=1799 loops=1)
"                    Sort Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (SubPlan 1), 5000))"
                    Sort Method: quicksort  Memory: 119kB
                    ->  ProjectSet  (cost=0.00..47574120.02 rows=1000000 width=36) (actual time=332.617..5792.758 rows=1799 loops=1)
                          ->  ProjectSet  (cost=0.00..5.02 rows=1000 width=32) (actual time=0.016..0.036 rows=17 loops=1)
                                ->  Result  (cost=0.00..0.01 rows=1 width=0) (actual time=0.000..0.001 rows=1 loops=1)
                          SubPlan 1
                            ->  Aggregate  (cost=47569.10..47569.11 rows=1 width=4) (actual time=340.736..340.736 rows=1 loops=17)
                                  ->  Seq Scan on users users_1  (cost=0.00..47550.44 rows=7463 width=4) (actual time=40.601..335.726 rows=87806 loops=17)
"                                        Filter: (EXTRACT(year FROM creationdate) = (generate_series('2008'::numeric, EXTRACT(year FROM now()))))"
                                        Rows Removed by Filter: 1404890
        ->  Sort  (cost=711198.82..711431.26 rows=92977 width=16) (actual time=1894.940..2474.599 rows=8981302 loops=1)
              Sort Key: (EXTRACT(year FROM users.creationdate))
              Sort Method: external sort  Disk: 3288kB
              ->  Gather  (cost=659618.80..703526.09 rows=92977 width=16) (actual time=1733.099..1865.968 rows=86197 loops=1)
                    Workers Planned: 3
                    Workers Launched: 3
                    ->  Parallel Hash Semi Join  (cost=658618.80..693228.39 rows=29993 width=16) (actual time=1708.526..1842.693 rows=21549 loops=4)
                          Hash Cond: (users.id = a.owneruserid)
                          ->  Parallel Seq Scan on users  (cost=0.00..29975.15 rows=481515 width=16) (actual time=0.665..62.236 rows=373174 loops=4)
                          ->  Parallel Hash  (cost=657931.72..657931.72 rows=54966 width=8) (actual time=1707.561..1707.772 rows=93277 loops=4)
                                Buckets: 524288 (originally 262144)  Batches: 1 (originally 1)  Memory Usage: 20672kB
                                ->  Parallel Hash Semi Join  (cost=184015.26..657931.72 rows=54966 width=8) (actual time=481.074..1682.315 rows=93277 loops=4)
                                      Hash Cond: (a.id = v.postid)
                                      ->  Parallel Seq Scan on answers a  (cost=0.00..453085.26 rows=1106826 width=12) (actual time=0.678..948.801 rows=1106826 loops=4)
                                      ->  Parallel Hash  (cost=182136.46..182136.46 rows=150304 width=8) (actual time=475.406..475.408 rows=93277 loops=4)
                                            Buckets: 1048576  Batches: 1  Memory Usage: 22816kB
                                            ->  Hash Join  (cost=1.63..182136.46 rows=150304 width=8) (actual time=0.770..452.373 rows=93277 loops=4)
                                                  Hash Cond: (v.votetypeid = vt.id)
                                                  ->  Parallel Index Scan using votes_creationdate_idx on votes v  (cost=0.44..174939.47 rows=2104256 width=10) (actual time=0.268..327.336 rows=2109264 loops=4)
                                                        Index Cond: (creationdate >= (now() - '5 years'::interval))
                                                  ->  Hash  (cost=1.18..1.18 rows=1 width=2) (actual time=0.224..0.225 rows=1 loops=4)
                                                        Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                                        ->  Seq Scan on votestypes vt  (cost=0.00..1.18 rows=1 width=2) (actual time=0.219..0.221 rows=1 loops=4)
                                                              Filter: ((name)::text = 'AcceptedByOriginator'::text)
                                                              Rows Removed by Filter: 13
Planning Time: 11.385 ms
Execution Time: 9452.244 ms


```

# Q2_V1

## Sem novos Ã­ndices

```postgresql
GroupAggregate  (cost=3240695.76..423743654.84 rows=20000 width=44) (actual time=7737.509..8992.835 rows=1799 loops=1)
"  Group Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (SubPlan 2), 5000))"
  CTE utilizadores
    ->  Gather  (cost=925973.18..975784.12 rows=92977 width=48) (actual time=6895.477..7557.094 rows=86197 loops=1)
          Workers Planned: 2
          Workers Launched: 2
          ->  Parallel Hash Semi Join  (cost=924973.18..965486.42 rows=38740 width=48) (actual time=6874.036..7517.426 rows=28732 loops=3)
                Hash Cond: (u_1.id = a.owneruserid)
                ->  Parallel Seq Scan on users u_1  (cost=0.00..31379.57 rows=621957 width=16) (actual time=46.512..561.062 rows=497565 loops=3)
                ->  Parallel Hash  (cost=923828.07..923828.07 rows=91609 width=8) (actual time=6827.156..6827.160 rows=124369 loops=3)
                      Buckets: 524288 (originally 262144)  Batches: 1 (originally 1)  Memory Usage: 20672kB
                      ->  Parallel Hash Semi Join  (cost=390412.74..923828.07 rows=91609 width=8) (actual time=6544.926..6798.215 rows=124369 loops=3)
                            Hash Cond: (a.id = v.postid)
                            ->  Parallel Seq Scan on answers a  (cost=0.00..460464.10 rows=1844710 width=12) (actual time=0.340..3963.183 rows=1475768 loops=3)
                            ->  Parallel Hash  (cost=386302.25..386302.25 rows=250519 width=8) (actual time=2346.224..2346.226 rows=124369 loops=3)
                                  Buckets: 262144  Batches: 4  Memory Usage: 5760kB
                                  ->  Hash Join  (cost=1.19..386302.25 rows=250519 width=8) (actual time=1461.410..2323.181 rows=124369 loops=3)
                                        Hash Cond: (v.votetypeid = vt.id)
                                        ->  Parallel Seq Scan on votes v  (cost=0.00..374307.48 rows=3507262 width=10) (actual time=1461.011..2191.890 rows=2812351 loops=3)
                                              Filter: (creationdate >= (now() - '5 years'::interval))
                                              Rows Removed by Filter: 5706453
                                        ->  Hash  (cost=1.18..1.18 rows=1 width=2) (actual time=0.343..0.344 rows=1 loops=3)
                                              Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                              ->  Seq Scan on votestypes vt  (cost=0.00..1.18 rows=1 width=2) (actual time=0.331..0.333 rows=1 loops=3)
                                                    Filter: ((name)::text = 'AcceptedByOriginator'::text)
                                                    Rows Removed by Filter: 13
  ->  Merge Left Join  (cost=2264911.64..422764184.08 rows=464885 width=40) (actual time=7737.235..8953.081 rows=87363 loops=1)
"        Merge Cond: ((generate_series('2008'::numeric, EXTRACT(year FROM now()))) = u.ano)"
"        Join Filter: (u.rep = ((generate_series(0, (SubPlan 2), 5000)))::double precision)"
        Rows Removed by Join Filter: 8895106
        ->  Group  (cost=2252516.37..420891516.37 rows=200000 width=36) (actual time=7708.844..7709.474 rows=1799 loops=1)
"              Group Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (SubPlan 2), 5000))"
              ->  Sort  (cost=2252516.37..2255016.37 rows=1000000 width=36) (actual time=7708.843..7709.048 rows=1799 loops=1)
"                    Sort Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (SubPlan 2), 5000))"
                    Sort Method: quicksort  Memory: 119kB
                    ->  ProjectSet  (cost=0.00..2098167.52 rows=1000000 width=36) (actual time=7555.458..7708.561 rows=1799 loops=1)
                          ->  ProjectSet  (cost=0.00..5.02 rows=1000 width=32) (actual time=0.006..0.019 rows=17 loops=1)
                                ->  Result  (cost=0.00..0.01 rows=1 width=0) (actual time=0.000..0.001 rows=1 loops=1)
                          SubPlan 2
                            ->  Aggregate  (cost=2093.14..2093.16 rows=1 width=4) (actual time=453.435..453.435 rows=1 loops=17)
                                  ->  CTE Scan on utilizadores  (cost=0.00..2091.98 rows=465 width=4) (actual time=407.047..453.215 rows=5070 loops=17)
"                                        Filter: (ano = (generate_series('2008'::numeric, EXTRACT(year FROM now()))))"
                                        Rows Removed by Filter: 81127
        ->  Materialize  (cost=12395.27..12860.16 rows=92977 width=44) (actual time=28.383..278.194 rows=8981302 loops=1)
              ->  Sort  (cost=12395.27..12627.72 rows=92977 width=44) (actual time=28.376..35.665 rows=86197 loops=1)
                    Sort Key: u.ano
                    Sort Method: external merge  Disk: 2880kB
                    ->  CTE Scan on utilizadores u  (cost=0.00..1859.54 rows=92977 width=44) (actual time=0.009..9.053 rows=86197 loops=1)
Planning Time: 8.567 ms
Execution Time: 8995.701 ms

```

## Com Ã­ndices

```postgresql

GroupAggregate  (cost=3055369.39..423558328.47 rows=20000 width=44) (actual time=2587.199..3857.879 rows=1799 loops=1)
"  Group Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (SubPlan 2), 5000))"
  CTE utilizadores
    ->  Gather  (cost=740646.82..790457.75 rows=92977 width=48) (actual time=2215.316..2414.288 rows=86197 loops=1)
          Workers Planned: 2
          Workers Launched: 2
          ->  Parallel Hash Semi Join  (cost=739646.82..780160.05 rows=38740 width=48) (actual time=2182.462..2363.740 rows=28732 loops=3)
                Hash Cond: (u_1.id = a.owneruserid)
                ->  Parallel Seq Scan on users u_1  (cost=0.00..31379.57 rows=621957 width=16) (actual time=0.490..79.046 rows=497565 loops=3)
                ->  Parallel Hash  (cost=738501.70..738501.70 rows=91609 width=8) (actual time=2180.786..2180.790 rows=124369 loops=3)
                      Buckets: 524288 (originally 262144)  Batches: 1 (originally 1)  Memory Usage: 20672kB
                      ->  Parallel Hash Semi Join  (cost=205086.37..738501.70 rows=91609 width=8) (actual time=1952.184..2142.240 rows=124369 loops=3)
                            Hash Cond: (a.id = v.postid)
                            ->  Parallel Seq Scan on answers a  (cost=0.00..460464.10 rows=1844710 width=12) (actual time=0.438..1171.704 rows=1475768 loops=3)
                            ->  Parallel Hash  (cost=200975.78..200975.78 rows=250527 width=8) (actual time=591.052..591.054 rows=124369 loops=3)
                                  Buckets: 262144  Batches: 4  Memory Usage: 5760kB
                                  ->  Hash Join  (cost=1.63..200975.78 rows=250527 width=8) (actual time=1.476..568.867 rows=124369 loops=3)
                                        Hash Cond: (v.votetypeid = vt.id)
                                        ->  Parallel Index Scan using votes_creationdate_idx on votes v  (cost=0.44..188980.63 rows=3507372 width=10) (actual time=0.920..404.246 rows=2812351 loops=3)
                                              Index Cond: (creationdate >= (now() - '5 years'::interval))
                                        ->  Hash  (cost=1.18..1.18 rows=1 width=2) (actual time=0.293..0.294 rows=1 loops=3)
                                              Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                              ->  Seq Scan on votestypes vt  (cost=0.00..1.18 rows=1 width=2) (actual time=0.284..0.286 rows=1 loops=3)
                                                    Filter: ((name)::text = 'AcceptedByOriginator'::text)
                                                    Rows Removed by Filter: 13
  ->  Merge Left Join  (cost=2264911.64..422764184.08 rows=464885 width=40) (actual time=2586.926..3822.235 rows=87363 loops=1)
"        Merge Cond: ((generate_series('2008'::numeric, EXTRACT(year FROM now()))) = u.ano)"
"        Join Filter: (u.rep = ((generate_series(0, (SubPlan 2), 5000)))::double precision)"
        Rows Removed by Join Filter: 8895106
        ->  Group  (cost=2252516.37..420891516.37 rows=200000 width=36) (actual time=2559.101..2559.759 rows=1799 loops=1)
"              Group Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (SubPlan 2), 5000))"
              ->  Sort  (cost=2252516.37..2255016.37 rows=1000000 width=36) (actual time=2559.099..2559.304 rows=1799 loops=1)
"                    Sort Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (SubPlan 2), 5000))"
                    Sort Method: quicksort  Memory: 119kB
                    ->  ProjectSet  (cost=0.00..2098167.52 rows=1000000 width=36) (actual time=2410.305..2558.785 rows=1799 loops=1)
                          ->  ProjectSet  (cost=0.00..5.02 rows=1000 width=32) (actual time=0.006..0.018 rows=17 loops=1)
                                ->  Result  (cost=0.00..0.01 rows=1 width=0) (actual time=0.000..0.001 rows=1 loops=1)
                          SubPlan 2
                            ->  Aggregate  (cost=2093.14..2093.16 rows=1 width=4) (actual time=150.506..150.506 rows=1 loops=17)
                                  ->  CTE Scan on utilizadores  (cost=0.00..2091.98 rows=465 width=4) (actual time=131.707..150.293 rows=5070 loops=17)
"                                        Filter: (ano = (generate_series('2008'::numeric, EXTRACT(year FROM now()))))"
                                        Rows Removed by Filter: 81127
        ->  Materialize  (cost=12395.27..12860.16 rows=92977 width=44) (actual time=27.818..280.156 rows=8981302 loops=1)
              ->  Sort  (cost=12395.27..12627.72 rows=92977 width=44) (actual time=27.813..34.664 rows=86197 loops=1)
                    Sort Key: u.ano
                    Sort Method: external merge  Disk: 2880kB
                    ->  CTE Scan on utilizadores u  (cost=0.00..1859.54 rows=92977 width=44) (actual time=0.010..9.153 rows=86197 loops=1)
Planning Time: 4.710 ms
Execution Time: 3860.531 ms

```


### Com
```
max_worker_processes = 16		# (change requires restart)
max_parallel_workers_per_gather = 4	# taken from max_parallel_workers
max_parallel_maintenance_workers = 4	# taken from max_parallel_workers
max_parallel_workers = 16		# maximum number of max_worker_processes that
```
SÃ³ utilizou 3 workers

```postgresql

GroupAggregate  (cost=2968812.47..423471771.55 rows=20000 width=44) (actual time=2103.448..3330.765 rows=1799 loops=1)
"  Group Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (SubPlan 2), 5000))"
  CTE utilizadores
    ->  Gather  (cost=659618.63..703900.83 rows=92977 width=48) (actual time=1770.459..1901.811 rows=86197 loops=1)
          Workers Planned: 3
          Workers Launched: 3
          ->  Parallel Hash Semi Join  (cost=658618.63..693603.13 rows=29993 width=48) (actual time=1736.134..1878.995 rows=21549 loops=4)
                Hash Cond: (u_1.id = a.owneruserid)
                ->  Parallel Seq Scan on users u_1  (cost=0.00..29975.15 rows=481515 width=16) (actual time=0.596..61.603 rows=373174 loops=4)
                ->  Parallel Hash  (cost=657931.55..657931.55 rows=54966 width=8) (actual time=1735.198..1735.376 rows=93277 loops=4)
                      Buckets: 524288 (originally 262144)  Batches: 1 (originally 1)  Memory Usage: 20736kB
                      ->  Parallel Hash Semi Join  (cost=184015.09..657931.55 rows=54966 width=8) (actual time=506.145..1697.739 rows=93277 loops=4)
                            Hash Cond: (a.id = v.postid)
                            ->  Parallel Seq Scan on answers a  (cost=0.00..453085.26 rows=1106826 width=12) (actual time=0.672..938.133 rows=1106826 loops=4)
                            ->  Parallel Hash  (cost=182136.29..182136.29 rows=150304 width=8) (actual time=499.735..499.737 rows=93277 loops=4)
                                  Buckets: 1048576  Batches: 1  Memory Usage: 22880kB
                                  ->  Hash Join  (cost=1.63..182136.29 rows=150304 width=8) (actual time=0.776..466.425 rows=93277 loops=4)
                                        Hash Cond: (v.votetypeid = vt.id)
                                        ->  Parallel Index Scan using votes_creationdate_idx on votes v  (cost=0.44..174939.31 rows=2104252 width=10) (actual time=0.338..337.145 rows=2109264 loops=4)
                                              Index Cond: (creationdate >= (now() - '5 years'::interval))
                                        ->  Hash  (cost=1.18..1.18 rows=1 width=2) (actual time=0.304..0.304 rows=1 loops=4)
                                              Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                              ->  Seq Scan on votestypes vt  (cost=0.00..1.18 rows=1 width=2) (actual time=0.295..0.297 rows=1 loops=4)
                                                    Filter: ((name)::text = 'AcceptedByOriginator'::text)
                                                    Rows Removed by Filter: 13
  ->  Merge Left Join  (cost=2264911.64..422764184.08 rows=464885 width=40) (actual time=2103.169..3318.573 rows=87363 loops=1)
"        Merge Cond: ((generate_series('2008'::numeric, EXTRACT(year FROM now()))) = u.ano)"
"        Join Filter: (u.rep = ((generate_series(0, (SubPlan 2), 5000)))::double precision)"
        Rows Removed by Join Filter: 8895106
        ->  Group  (cost=2252516.37..420891516.37 rows=200000 width=36) (actual time=2075.177..2075.802 rows=1799 loops=1)
"              Group Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (SubPlan 2), 5000))"
              ->  Sort  (cost=2252516.37..2255016.37 rows=1000000 width=36) (actual time=2075.176..2075.405 rows=1799 loops=1)
"                    Sort Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (SubPlan 2), 5000))"
                    Sort Method: quicksort  Memory: 119kB
                    ->  ProjectSet  (cost=0.00..2098167.52 rows=1000000 width=36) (actual time=1925.309..2074.902 rows=1799 loops=1)
                          ->  ProjectSet  (cost=0.00..5.02 rows=1000 width=32) (actual time=0.005..0.016 rows=17 loops=1)
                                ->  Result  (cost=0.00..0.01 rows=1 width=0) (actual time=0.000..0.001 rows=1 loops=1)
                          SubPlan 2
                            ->  Aggregate  (cost=2093.14..2093.16 rows=1 width=4) (actual time=122.044..122.044 rows=1 loops=17)
                                  ->  CTE Scan on utilizadores  (cost=0.00..2091.98 rows=465 width=4) (actual time=105.554..121.837 rows=5070 loops=17)
"                                        Filter: (ano = (generate_series('2008'::numeric, EXTRACT(year FROM now()))))"
                                        Rows Removed by Filter: 81127
        ->  Materialize  (cost=12395.27..12860.16 rows=92977 width=44) (actual time=27.986..279.658 rows=8981302 loops=1)
              ->  Sort  (cost=12395.27..12627.72 rows=92977 width=44) (actual time=27.982..34.867 rows=86197 loops=1)
                    Sort Key: u.ano
                    Sort Method: external merge  Disk: 2880kB
                    ->  CTE Scan on utilizadores u  (cost=0.00..1859.54 rows=92977 width=44) (actual time=0.007..9.237 rows=86197 loops=1)
Planning Time: 9.296 ms
Execution Time: 3334.089 ms


```
# Q2_V2

## Com Ã­ndices

```postgresql


Sort  (cost=879218.17..879268.17 rows=20000 width=44) (actual time=2598.458..2623.704 rows=1799 loops=1)
"  Sort Key: buckets.year, buckets.reputation_range"
  Sort Method: quicksort  Memory: 133kB
  CTE utilizadores
    ->  Gather  (cost=740646.22..790457.16 rows=92977 width=48) (actual time=2266.404..2463.403 rows=86197 loops=1)
          Workers Planned: 2
          Workers Launched: 2
          ->  Parallel Hash Semi Join  (cost=739646.22..780159.46 rows=38740 width=48) (actual time=2236.082..2433.211 rows=28732 loops=3)
                Hash Cond: (u_2.id = a.owneruserid)
                ->  Parallel Seq Scan on users u_2  (cost=0.00..31379.57 rows=621957 width=16) (actual time=0.420..84.703 rows=497565 loops=3)
                ->  Parallel Hash  (cost=738501.11..738501.11 rows=91609 width=8) (actual time=2234.259..2234.422 rows=124369 loops=3)
                      Buckets: 524288 (originally 262144)  Batches: 1 (originally 1)  Memory Usage: 20704kB
                      ->  Parallel Hash Semi Join  (cost=205085.77..738501.11 rows=91609 width=8) (actual time=1963.691..2188.658 rows=124369 loops=3)
                            Hash Cond: (a.id = v.postid)
                            ->  Parallel Seq Scan on answers a  (cost=0.00..460464.10 rows=1844710 width=12) (actual time=0.458..1178.551 rows=1475768 loops=3)
                            ->  Parallel Hash  (cost=200975.21..200975.21 rows=250525 width=8) (actual time=575.610..575.613 rows=124369 loops=3)
                                  Buckets: 262144  Batches: 4  Memory Usage: 5760kB
                                  ->  Hash Join  (cost=1.63..200975.21 rows=250525 width=8) (actual time=0.693..551.804 rows=124369 loops=3)
                                        Hash Cond: (v.votetypeid = vt.id)
                                        ->  Parallel Index Scan using votes_creationdate_idx on votes v  (cost=0.44..188980.13 rows=3507354 width=10) (actual time=0.445..390.237 rows=2812351 loops=3)
                                              Index Cond: (creationdate >= (now() - '5 years'::interval))
                                        ->  Hash  (cost=1.18..1.18 rows=1 width=2) (actual time=0.215..0.216 rows=1 loops=3)
                                              Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                              ->  Seq Scan on votestypes vt  (cost=0.00..1.18 rows=1 width=2) (actual time=0.207..0.209 rows=1 loops=3)
                                                    Filter: ((name)::text = 'AcceptedByOriginator'::text)
                                                    Rows Removed by Filter: 13
  ->  HashAggregate  (cost=87132.25..87332.25 rows=20000 width=44) (actual time=2597.154..2597.422 rows=1799 loops=1)
"        Group Key: buckets.year, buckets.reputation_range"
        Batches: 1  Memory Usage: 913kB
        ->  Merge Left Join  (cost=72115.47..83645.61 rows=464885 width=40) (actual time=2555.671..2582.786 rows=87363 loops=1)
              Merge Cond: ((buckets.year = u.ano) AND (((buckets.reputation_range)::double precision) = u.rep))
              ->  Sort  (cost=59720.19..60220.19 rows=200000 width=36) (actual time=2520.240..2520.301 rows=1799 loops=1)
"                    Sort Key: buckets.year, ((buckets.reputation_range)::double precision)"
                    Sort Method: quicksort  Memory: 133kB
                    ->  Subquery Scan on buckets  (cost=12234.15..36640.05 rows=200000 width=36) (actual time=2491.742..2519.938 rows=1799 loops=1)
                          ->  Group  (cost=12234.15..36640.05 rows=200000 width=36) (actual time=2491.741..2519.830 rows=1799 loops=1)
"                                Group Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (max(u_1.reputation)), 5000))"
                                ->  Incremental Sort  (cost=12234.15..35140.05 rows=200000 width=36) (actual time=2491.740..2519.635 rows=1799 loops=1)
"                                      Sort Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (max(u_1.reputation)), 5000))"
"                                      Presorted Key: (generate_series('2008'::numeric, EXTRACT(year FROM now())))"
                                      Full-sort Groups: 14  Sort Method: quicksort  Average Memory: 27kB  Peak Memory: 27kB
                                      Pre-sorted Groups: 12  Sort Method: quicksort  Average Memory: 36kB  Peak Memory: 36kB
                                      ->  ProjectSet  (cost=12131.63..22670.27 rows=200000 width=36) (actual time=2490.915..2519.280 rows=1799 loops=1)
                                            ->  GroupAggregate  (cost=12131.63..21668.77 rows=200 width=36) (actual time=2490.912..2519.190 rows=17 loops=1)
"                                                  Group Key: (generate_series('2008'::numeric, EXTRACT(year FROM now())))"
                                                  ->  Merge Join  (cost=12131.63..19342.34 rows=464885 width=36) (actual time=2490.585..2513.006 rows=86197 loops=1)
"                                                        Merge Cond: ((generate_series('2008'::numeric, EXTRACT(year FROM now()))) = u_1.ano)"
                                                        ->  Sort  (cost=54.85..57.35 rows=1000 width=32) (actual time=0.010..0.015 rows=17 loops=1)
"                                                              Sort Key: (generate_series('2008'::numeric, EXTRACT(year FROM now())))"
                                                              Sort Method: quicksort  Memory: 25kB
                                                              ->  ProjectSet  (cost=0.00..5.02 rows=1000 width=32) (actual time=0.005..0.007 rows=17 loops=1)
                                                                    ->  Result  (cost=0.00..0.01 rows=1 width=0) (actual time=0.000..0.000 rows=1 loops=1)
                                                        ->  Materialize  (cost=12076.77..12541.66 rows=92977 width=36) (actual time=2490.569..2503.277 rows=86197 loops=1)
                                                              ->  Sort  (cost=12076.77..12309.22 rows=92977 width=36) (actual time=2490.565..2497.493 rows=86197 loops=1)
                                                                    Sort Key: u_1.ano
                                                                    Sort Method: external merge  Disk: 1608kB
                                                                    ->  CTE Scan on utilizadores u_1  (cost=0.00..1859.54 rows=92977 width=36) (actual time=2266.407..2463.784 rows=86197 loops=1)
              ->  Materialize  (cost=12395.27..12860.16 rows=92977 width=44) (actual time=35.425..50.254 rows=86197 loops=1)
                    ->  Sort  (cost=12395.27..12627.72 rows=92977 width=44) (actual time=35.417..44.278 rows=86197 loops=1)
"                          Sort Key: u.ano, u.rep"
                          Sort Method: external merge  Disk: 2880kB
                          ->  CTE Scan on utilizadores u  (cost=0.00..1859.54 rows=92977 width=44) (actual time=0.085..9.527 rows=86197 loops=1)
Planning Time: 0.918 ms
Execution Time: 2627.517 ms

```
### Com
```
max_worker_processes = 16		# (change requires restart)
max_parallel_workers_per_gather = 4	# taken from max_parallel_workers
max_parallel_maintenance_workers = 4	# taken from max_parallel_workers
max_parallel_workers = 16		# maximum number of max_worker_processes that
```
SÃ³ utilizou 3 workers

```postgresql

Sort  (cost=792661.81..792711.81 rows=20000 width=44) (actual time=1935.854..1939.334 rows=1799 loops=1)
"  Sort Key: buckets.year, buckets.reputation_range"
  Sort Method: quicksort  Memory: 133kB
  CTE utilizadores
    ->  Gather  (cost=659618.59..703900.79 rows=92977 width=48) (actual time=1667.657..1782.582 rows=86197 loops=1)
          Workers Planned: 3
          Workers Launched: 3
          ->  Parallel Hash Semi Join  (cost=658618.59..693603.09 rows=29993 width=48) (actual time=1643.856..1779.593 rows=21549 loops=4)
                Hash Cond: (u_2.id = a.owneruserid)
                ->  Parallel Seq Scan on users u_2  (cost=0.00..29975.15 rows=481515 width=16) (actual time=0.617..60.962 rows=373174 loops=4)
                ->  Parallel Hash  (cost=657931.51..657931.51 rows=54966 width=8) (actual time=1642.967..1643.204 rows=93277 loops=4)
                      Buckets: 524288 (originally 262144)  Batches: 1 (originally 1)  Memory Usage: 20704kB
                      ->  Parallel Hash Semi Join  (cost=184015.05..657931.51 rows=54966 width=8) (actual time=456.142..1610.943 rows=93277 loops=4)
                            Hash Cond: (a.id = v.postid)
                            ->  Parallel Seq Scan on answers a  (cost=0.00..453085.26 rows=1106826 width=12) (actual time=0.650..908.183 rows=1106826 loops=4)
                            ->  Parallel Hash  (cost=182136.25..182136.25 rows=150304 width=8) (actual time=450.135..450.137 rows=93277 loops=4)
                                  Buckets: 1048576  Batches: 1  Memory Usage: 22848kB
                                  ->  Hash Join  (cost=1.63..182136.25 rows=150304 width=8) (actual time=0.723..428.265 rows=93277 loops=4)
                                        Hash Cond: (v.votetypeid = vt.id)
                                        ->  Parallel Index Scan using votes_creationdate_idx on votes v  (cost=0.44..174939.27 rows=2104252 width=10) (actual time=0.475..308.004 rows=2109264 loops=4)
                                              Index Cond: (creationdate >= (now() - '5 years'::interval))
                                        ->  Hash  (cost=1.18..1.18 rows=1 width=2) (actual time=0.217..0.218 rows=1 loops=4)
                                              Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                              ->  Seq Scan on votestypes vt  (cost=0.00..1.18 rows=1 width=2) (actual time=0.213..0.215 rows=1 loops=4)
                                                    Filter: ((name)::text = 'AcceptedByOriginator'::text)
                                                    Rows Removed by Filter: 13
  ->  HashAggregate  (cost=87132.25..87332.25 rows=20000 width=44) (actual time=1934.524..1934.808 rows=1799 loops=1)
"        Group Key: buckets.year, buckets.reputation_range"
        Batches: 1  Memory Usage: 913kB
        ->  Merge Left Join  (cost=72115.47..83645.61 rows=464885 width=40) (actual time=1893.044..1920.273 rows=87363 loops=1)
              Merge Cond: ((buckets.year = u.ano) AND (((buckets.reputation_range)::double precision) = u.rep))
              ->  Sort  (cost=59720.19..60220.19 rows=200000 width=36) (actual time=1855.757..1855.819 rows=1799 loops=1)
"                    Sort Key: buckets.year, ((buckets.reputation_range)::double precision)"
                    Sort Method: quicksort  Memory: 133kB
                    ->  Subquery Scan on buckets  (cost=12234.15..36640.05 rows=200000 width=36) (actual time=1826.966..1855.443 rows=1799 loops=1)
                          ->  Group  (cost=12234.15..36640.05 rows=200000 width=36) (actual time=1826.963..1855.329 rows=1799 loops=1)
"                                Group Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (max(u_1.reputation)), 5000))"
                                ->  Incremental Sort  (cost=12234.15..35140.05 rows=200000 width=36) (actual time=1826.962..1855.132 rows=1799 loops=1)
"                                      Sort Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (max(u_1.reputation)), 5000))"
"                                      Presorted Key: (generate_series('2008'::numeric, EXTRACT(year FROM now())))"
                                      Full-sort Groups: 14  Sort Method: quicksort  Average Memory: 27kB  Peak Memory: 27kB
                                      Pre-sorted Groups: 12  Sort Method: quicksort  Average Memory: 36kB  Peak Memory: 36kB
                                      ->  ProjectSet  (cost=12131.63..22670.27 rows=200000 width=36) (actual time=1826.110..1854.771 rows=1799 loops=1)
                                            ->  GroupAggregate  (cost=12131.63..21668.77 rows=200 width=36) (actual time=1826.107..1854.682 rows=17 loops=1)
"                                                  Group Key: (generate_series('2008'::numeric, EXTRACT(year FROM now())))"
                                                  ->  Merge Join  (cost=12131.63..19342.34 rows=464885 width=36) (actual time=1825.766..1848.491 rows=86197 loops=1)
"                                                        Merge Cond: ((generate_series('2008'::numeric, EXTRACT(year FROM now()))) = u_1.ano)"
                                                        ->  Sort  (cost=54.85..57.35 rows=1000 width=32) (actual time=0.013..0.017 rows=17 loops=1)
"                                                              Sort Key: (generate_series('2008'::numeric, EXTRACT(year FROM now())))"
                                                              Sort Method: quicksort  Memory: 25kB
                                                              ->  ProjectSet  (cost=0.00..5.02 rows=1000 width=32) (actual time=0.005..0.008 rows=17 loops=1)
                                                                    ->  Result  (cost=0.00..0.01 rows=1 width=0) (actual time=0.000..0.001 rows=1 loops=1)
                                                        ->  Materialize  (cost=12076.77..12541.66 rows=92977 width=36) (actual time=1825.749..1838.584 rows=86197 loops=1)
                                                              ->  Sort  (cost=12076.77..12309.22 rows=92977 width=36) (actual time=1825.745..1832.712 rows=86197 loops=1)
                                                                    Sort Key: u_1.ano
                                                                    Sort Method: external merge  Disk: 1608kB
                                                                    ->  CTE Scan on utilizadores u_1  (cost=0.00..1859.54 rows=92977 width=36) (actual time=1667.660..1801.304 rows=86197 loops=1)
              ->  Materialize  (cost=12395.27..12860.16 rows=92977 width=44) (actual time=37.279..52.149 rows=86197 loops=1)
                    ->  Sort  (cost=12395.27..12627.72 rows=92977 width=44) (actual time=37.275..46.123 rows=86197 loops=1)
"                          Sort Key: u.ano, u.rep"
                          Sort Method: external merge  Disk: 2880kB
                          ->  CTE Scan on utilizadores u  (cost=0.00..1859.54 rows=92977 width=44) (actual time=0.069..10.952 rows=86197 loops=1)
Planning Time: 9.672 ms
Execution Time: 1943.087 ms

```

# Q2_V3

## Com Ã­ndices

```postgresql

Sort  (cost=619149.86..619199.86 rows=20000 width=44) (actual time=4846.911..4850.247 rows=1799 loops=1)
"  Sort Key: buckets.year, buckets.reputation_range"
  Sort Method: quicksort  Memory: 133kB
  CTE utilizadores
    ->  Gather  (cost=479657.83..530388.84 rows=92977 width=48) (actual time=4231.759..4694.335 rows=86197 loops=1)
          Workers Planned: 2
          Workers Launched: 2
          ->  Parallel Hash Semi Join  (cost=478657.83..520091.14 rows=38740 width=48) (actual time=4210.622..4691.543 rows=28732 loops=3)
                Hash Cond: (u_2.id = a.owneruserid)
                ->  Parallel Seq Scan on users u_2  (cost=0.00..31379.57 rows=621957 width=16) (actual time=0.709..341.665 rows=497565 loops=3)
                ->  Parallel Hash  (cost=476707.69..476707.69 rows=156011 width=8) (actual time=4209.371..4209.489 rows=124369 loops=3)
                      Buckets: 524288  Batches: 1  Memory Usage: 18624kB
                      ->  Parallel Hash Semi Join  (cost=9665.61..476707.69 rows=156011 width=8) (actual time=40.178..4174.928 rows=124369 loops=3)
                            Hash Cond: (a.id = mv_votos.postid)
                            ->  Parallel Seq Scan on answers a  (cost=0.00..460464.10 rows=1844710 width=12) (actual time=0.633..3718.779 rows=1475768 loops=3)
                            ->  Parallel Hash  (cost=7715.47..7715.47 rows=156011 width=8) (actual time=34.183..34.183 rows=124369 loops=3)
                                  Buckets: 524288  Batches: 1  Memory Usage: 18720kB
                                  ->  Parallel Index Scan using mv_votos_creationdate_idx on mv_votos  (cost=0.43..7715.47 rows=156011 width=8) (actual time=0.333..15.726 rows=124369 loops=3)
                                        Index Cond: (creationdate >= (now() - '5 years'::interval))
  ->  HashAggregate  (cost=87132.25..87332.25 rows=20000 width=44) (actual time=4845.608..4845.874 rows=1799 loops=1)
"        Group Key: buckets.year, buckets.reputation_range"
        Batches: 1  Memory Usage: 913kB
        ->  Merge Left Join  (cost=72115.47..83645.61 rows=464885 width=40) (actual time=4803.541..4831.256 rows=87363 loops=1)
              Merge Cond: ((buckets.year = u.ano) AND (((buckets.reputation_range)::double precision) = u.rep))
              ->  Sort  (cost=59720.19..60220.19 rows=200000 width=36) (actual time=4768.443..4768.512 rows=1799 loops=1)
"                    Sort Key: buckets.year, ((buckets.reputation_range)::double precision)"
                    Sort Method: quicksort  Memory: 133kB
                    ->  Subquery Scan on buckets  (cost=12234.15..36640.05 rows=200000 width=36) (actual time=4740.270..4768.137 rows=1799 loops=1)
                          ->  Group  (cost=12234.15..36640.05 rows=200000 width=36) (actual time=4740.269..4768.022 rows=1799 loops=1)
"                                Group Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (max(u_1.reputation)), 5000))"
                                ->  Incremental Sort  (cost=12234.15..35140.05 rows=200000 width=36) (actual time=4740.268..4767.823 rows=1799 loops=1)
"                                      Sort Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (max(u_1.reputation)), 5000))"
"                                      Presorted Key: (generate_series('2008'::numeric, EXTRACT(year FROM now())))"
                                      Full-sort Groups: 14  Sort Method: quicksort  Average Memory: 27kB  Peak Memory: 27kB
                                      Pre-sorted Groups: 12  Sort Method: quicksort  Average Memory: 36kB  Peak Memory: 36kB
                                      ->  ProjectSet  (cost=12131.63..22670.27 rows=200000 width=36) (actual time=4739.433..4767.468 rows=1799 loops=1)
                                            ->  GroupAggregate  (cost=12131.63..21668.77 rows=200 width=36) (actual time=4739.430..4767.375 rows=17 loops=1)
"                                                  Group Key: (generate_series('2008'::numeric, EXTRACT(year FROM now())))"
                                                  ->  Merge Join  (cost=12131.63..19342.34 rows=464885 width=36) (actual time=4739.108..4761.238 rows=86197 loops=1)
"                                                        Merge Cond: ((generate_series('2008'::numeric, EXTRACT(year FROM now()))) = u_1.ano)"
                                                        ->  Sort  (cost=54.85..57.35 rows=1000 width=32) (actual time=0.011..0.015 rows=17 loops=1)
"                                                              Sort Key: (generate_series('2008'::numeric, EXTRACT(year FROM now())))"
                                                              Sort Method: quicksort  Memory: 25kB
                                                              ->  ProjectSet  (cost=0.00..5.02 rows=1000 width=32) (actual time=0.004..0.006 rows=17 loops=1)
                                                                    ->  Result  (cost=0.00..0.01 rows=1 width=0) (actual time=0.000..0.001 rows=1 loops=1)
                                                        ->  Materialize  (cost=12076.77..12541.66 rows=92977 width=36) (actual time=4739.092..4751.623 rows=86197 loops=1)
                                                              ->  Sort  (cost=12076.77..12309.22 rows=92977 width=36) (actual time=4739.090..4745.875 rows=86197 loops=1)
                                                                    Sort Key: u_1.ano
                                                                    Sort Method: external merge  Disk: 1608kB
                                                                    ->  CTE Scan on utilizadores u_1  (cost=0.00..1859.54 rows=92977 width=36) (actual time=4231.763..4716.655 rows=86197 loops=1)
              ->  Materialize  (cost=12395.27..12860.16 rows=92977 width=44) (actual time=35.092..50.379 rows=86197 loops=1)
                    ->  Sort  (cost=12395.27..12627.72 rows=92977 width=44) (actual time=35.090..44.452 rows=86197 loops=1)
"                          Sort Key: u.ano, u.rep"
                          Sort Method: external merge  Disk: 2880kB
                          ->  CTE Scan on utilizadores u  (cost=0.00..1859.54 rows=92977 width=44) (actual time=0.048..9.397 rows=86197 loops=1)
Planning Time: 1.555 ms
Execution Time: 4854.275 ms


```

```
max_worker_processes = 16		# (change requires restart)
max_parallel_workers_per_gather = 4	# taken from max_parallel_workers
max_parallel_maintenance_workers = 4	# taken from max_parallel_workers
max_parallel_workers = 16		# maximum number of max_worker_processes that
```
SÃ³ utilizou 3 workers

```postgresql

Sort  (cost=602363.10..602413.10 rows=20000 width=44) (actual time=1613.943..1616.799 rows=1799 loops=1)
"  Sort Key: buckets.year, buckets.reputation_range"
  Sort Method: quicksort  Memory: 133kB
  CTE utilizadores
    ->  Gather  (cost=468869.98..513602.08 rows=92977 width=48) (actual time=1334.727..1444.801 rows=86197 loops=1)
          Workers Planned: 3
          Workers Launched: 3
          ->  Parallel Hash Semi Join  (cost=467869.98..503304.38 rows=29993 width=48) (actual time=1302.164..1440.600 rows=21549 loops=4)
                Hash Cond: (u_2.id = a.owneruserid)
                ->  Parallel Seq Scan on users u_2  (cost=0.00..29975.15 rows=481515 width=16) (actual time=0.670..60.855 rows=373174 loops=4)
                ->  Parallel Hash  (cost=466699.52..466699.52 rows=93637 width=8) (actual time=1301.003..1301.062 rows=93277 loops=4)
                      Buckets: 524288  Batches: 1  Memory Usage: 18624kB
                      ->  Parallel Hash Semi Join  (cost=9667.13..466699.52 rows=93637 width=8) (actual time=62.992..1267.671 rows=93277 loops=4)
                            Hash Cond: (a.id = mv_votos.postid)
                            ->  Parallel Seq Scan on answers a  (cost=0.00..453085.26 rows=1106826 width=12) (actual time=0.483..928.484 rows=1106826 loops=4)
                            ->  Parallel Hash  (cost=7716.36..7716.36 rows=156062 width=8) (actual time=58.157..58.158 rows=93277 loops=4)
                                  Buckets: 524288  Batches: 1  Memory Usage: 18784kB
                                  ->  Parallel Index Scan using mv_votos_creationdate_idx on mv_votos  (cost=0.43..7716.36 rows=156062 width=8) (actual time=0.348..21.848 rows=93277 loops=4)
                                        Index Cond: (creationdate >= (now() - '5 years'::interval))
  ->  HashAggregate  (cost=87132.25..87332.25 rows=20000 width=44) (actual time=1612.478..1612.800 rows=1799 loops=1)
"        Group Key: buckets.year, buckets.reputation_range"
        Batches: 1  Memory Usage: 913kB
        ->  Merge Left Join  (cost=72115.47..83645.61 rows=464885 width=40) (actual time=1570.202..1597.914 rows=87363 loops=1)
              Merge Cond: ((buckets.year = u.ano) AND (((buckets.reputation_range)::double precision) = u.rep))
              ->  Sort  (cost=59720.19..60220.19 rows=200000 width=36) (actual time=1530.580..1530.639 rows=1799 loops=1)
"                    Sort Key: buckets.year, ((buckets.reputation_range)::double precision)"
                    Sort Method: quicksort  Memory: 133kB
                    ->  Subquery Scan on buckets  (cost=12234.15..36640.05 rows=200000 width=36) (actual time=1502.070..1530.287 rows=1799 loops=1)
                          ->  Group  (cost=12234.15..36640.05 rows=200000 width=36) (actual time=1502.068..1530.176 rows=1799 loops=1)
"                                Group Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (max(u_1.reputation)), 5000))"
                                ->  Incremental Sort  (cost=12234.15..35140.05 rows=200000 width=36) (actual time=1502.067..1529.984 rows=1799 loops=1)
"                                      Sort Key: (generate_series('2008'::numeric, EXTRACT(year FROM now()))), (generate_series(0, (max(u_1.reputation)), 5000))"
"                                      Presorted Key: (generate_series('2008'::numeric, EXTRACT(year FROM now())))"
                                      Full-sort Groups: 14  Sort Method: quicksort  Average Memory: 27kB  Peak Memory: 27kB
                                      Pre-sorted Groups: 12  Sort Method: quicksort  Average Memory: 36kB  Peak Memory: 36kB
                                      ->  ProjectSet  (cost=12131.63..22670.27 rows=200000 width=36) (actual time=1501.224..1529.634 rows=1799 loops=1)
                                            ->  GroupAggregate  (cost=12131.63..21668.77 rows=200 width=36) (actual time=1501.222..1529.545 rows=17 loops=1)
"                                                  Group Key: (generate_series('2008'::numeric, EXTRACT(year FROM now())))"
                                                  ->  Merge Join  (cost=12131.63..19342.34 rows=464885 width=36) (actual time=1500.890..1523.425 rows=86197 loops=1)
"                                                        Merge Cond: ((generate_series('2008'::numeric, EXTRACT(year FROM now()))) = u_1.ano)"
                                                        ->  Sort  (cost=54.85..57.35 rows=1000 width=32) (actual time=0.015..0.017 rows=17 loops=1)
"                                                              Sort Key: (generate_series('2008'::numeric, EXTRACT(year FROM now())))"
                                                              Sort Method: quicksort  Memory: 25kB
                                                              ->  ProjectSet  (cost=0.00..5.02 rows=1000 width=32) (actual time=0.005..0.007 rows=17 loops=1)
                                                                    ->  Result  (cost=0.00..0.01 rows=1 width=0) (actual time=0.000..0.001 rows=1 loops=1)
                                                        ->  Materialize  (cost=12076.77..12541.66 rows=92977 width=36) (actual time=1500.871..1513.672 rows=86197 loops=1)
                                                              ->  Sort  (cost=12076.77..12309.22 rows=92977 width=36) (actual time=1500.866..1507.717 rows=86197 loops=1)
                                                                    Sort Key: u_1.ano
                                                                    Sort Method: external merge  Disk: 1608kB
                                                                    ->  CTE Scan on utilizadores u_1  (cost=0.00..1859.54 rows=92977 width=36) (actual time=1334.729..1465.428 rows=86197 loops=1)
              ->  Materialize  (cost=12395.27..12860.16 rows=92977 width=44) (actual time=39.617..54.731 rows=86197 loops=1)
                    ->  Sort  (cost=12395.27..12627.72 rows=92977 width=44) (actual time=39.614..48.649 rows=86197 loops=1)
"                          Sort Key: u.ano, u.rep"
                          Sort Method: external merge  Disk: 2880kB
                          ->  CTE Scan on utilizadores u  (cost=0.00..1859.54 rows=92977 width=44) (actual time=0.045..9.356 rows=86197 loops=1)
Planning Time: 6.808 ms
Execution Time: 1621.323 ms

```